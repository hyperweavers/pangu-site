import{d as r,g as S}from"./chunk-TKJL42GQ.js";import{a as W,b}from"./chunk-23Y56Z44.js";import{S as M,V as N,a as Y,aa as O,b as j,ga as V,p as C,u as I}from"./chunk-3IMHSIYC.js";var l=(function(a){return a.BUY="BUY",a.SELL="SELL",a})(l||{});var _=(()=>{class a{constructor(){let D=V(b),p=V(S);this.portfolio$=C(D.stocks$).pipe(N(U=>p.getStocks(U.map(f=>f.vendorCode.etm.primary)).pipe(I(f=>{let o=f.map(e=>{let c=U.find(n=>n.vendorCode.etm.primary===e.vendorCode.etm.primary),u=c?.transactions.reduce((n,t)=>t.type===l.BUY?n+t.quantity:n-t.quantity,0)||0,L=c?.transactions.reduce((n,t)=>t.type===l.BUY?n+t.quantity*t.price+(t.charges||0):n-t.quantity*t.price-(t.charges||0),0)||0,B=L/u||0,g=e.quote?.nse?(e.quote.nse.price-B)*u:0,h=g/L*100||0;return j(Y({},e),{id:c?.id||W(),transactions:c?.transactions||[],quantity:u,averagePrice:B,investment:L,marketValue:e.quote?.nse?e.quote.nse.price*u:0,totalProfitLoss:{direction:g>=0?r.UP:r.DOWN,percentage:h,value:g}})}),s=0,m=0,i=0,A=0,y=0,P=0,d=0,q=0;o.map(e=>{let c=e.quote?.nse&&e.quantity?e.quote.nse.price*e.quantity:0;s+=e.investment||0,m+=c,i+=e.quote?.nse&&e.quantity?e.quote.nse.change.value*e.quantity:0,A+=e.quote?.nse?.close&&e.quantity?e.quote.nse.close*e.quantity:0,e.quote?.nse?.change?.direction===r.UP?y++:P++,e.totalProfitLoss?.direction===r.UP?d++:q++});let w=i/A*100||0,v=m-s,x=v/s*100||0,E=y/o.length*100||0,$=P/o.length*100||0,F=d/o.length*100||0,R=q/o.length*100||0;return{holdings:o,investment:s,marketValue:m,dayProfitLoss:{direction:i>=0?r.UP:r.DOWN,percentage:w,value:i},totalProfitLoss:{direction:v>=0?r.UP:r.DOWN,percentage:x,value:v},dayAdvance:{percentage:E,value:y},dayDecline:{percentage:$,value:P},totalAdvance:{percentage:F,value:d},totalDecline:{percentage:R,value:q}}})))).pipe(M(1))}static{this.\u0275fac=function(p){return new(p||a)}}static{this.\u0275prov=O({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();export{l as a,_ as b};
