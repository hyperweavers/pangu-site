import{d as r,g as O}from"./chunk-LVMVLLEV.js";import{a as W,b}from"./chunk-HMZKLXPL.js";import{$ as I,Y as C,a as B,b as M,fa as N,la as D,q as S,v as Y}from"./chunk-PPE7DTG5.js";var p=function(a){return a.BUY="BUY",a.SELL="SELL",a}(p||{});var te=(()=>{class a{constructor(m,c){this.storageService=m,this.marketService=c,this.portfolio$=S(m.stocks$).pipe(I(U=>c.getStocks(U.map(f=>f.vendorCode.etm.primary)).pipe(Y(f=>{let n=f.map(e=>{let i=U.find(o=>o.vendorCode.etm.primary===e.vendorCode.etm.primary),l=i?.transactions.reduce((o,t)=>t.type===p.BUY?o+t.quantity:o-t.quantity,0)||0,g=i?.transactions.reduce((o,t)=>t.type===p.BUY?o+t.quantity*t.price+(t.charges||0):o-t.quantity*t.price-(t.charges||0),0)||0,j=g/l||0,V=e.quote?.nse?(e.quote.nse.price-j)*l:0,R=V/g*100||0;return M(B({},e),{id:i?.id||W(),transactions:i?.transactions||[],quantity:l,averagePrice:j,investment:g,marketValue:e.quote?.nse?e.quote.nse.price*l:0,totalProfitLoss:{direction:V>=0?r.UP:r.DOWN,percentage:R,value:V}})}),s=0,y=0,u=0,A=0,P=0,d=0,q=0,v=0;n.map(e=>{let i=e.quote?.nse&&e.quantity?e.quote.nse.price*e.quantity:0;s+=e.investment||0,y+=i,u+=e.quote?.nse&&e.quantity?e.quote.nse.change.value*e.quantity:0,A+=e.quote?.nse?.close&&e.quantity?e.quote.nse.close*e.quantity:0,e.quote?.nse?.change?.direction===r.UP?P++:d++,e.totalProfitLoss?.direction===r.UP?q++:v++});let h=u/A*100||0,L=y-s,w=L/s*100||0,x=P/n.length*100||0,E=d/n.length*100||0,$=q/n.length*100||0,F=v/n.length*100||0;return{holdings:n,investment:s,marketValue:y,dayProfitLoss:{direction:u>=0?r.UP:r.DOWN,percentage:h,value:u},totalProfitLoss:{direction:L>=0?r.UP:r.DOWN,percentage:w,value:L},dayAdvance:{percentage:x,value:P},dayDecline:{percentage:E,value:d},totalAdvance:{percentage:$,value:q},totalDecline:{percentage:F,value:v}}})))).pipe(C(1))}static{this.\u0275fac=function(c){return new(c||a)(D(b),D(O))}}static{this.\u0275prov=N({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();export{p as a,te as b};
